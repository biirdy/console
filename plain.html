<!DOCTYPE html>
<html>
<head>
	<script src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js" type="text/javascript"></script>
</head>
<body>

	<h1 id="header">Central Sensor Management</h1>
	<h2>Connected Sensors</h2>
	<p id="connected list"></p>
	<h2>Disconnected Sensors</h2>
	<p id="disconnected list"></p>

	<script type="text/javascript">
		
		//auto refresh
		/*setTimeout(function(){
			window.location.reload(true);
		}, 1000);*/

		downloadUrl("sensors.php", function(data){
			var xml 	= data.responseXML;
			var sensors = xml.documentElement.getElementsByTagName("sensor");

			var connected_html 		= "";
			var disconnected_html 	= "";

			for(var i = 0; i < sensors.length; i++){
				var id 		= sensors[i].getAttribute("id");
				var ip 		= sensors[i].getAttribute("ip");
				var active 	= sensors[i].getAttribute("active");
				var start 	= sensors[i].getAttribute("start");
				var end		= sensors[i].getAttribute("end");

				if(active == 1){
					connected_html = connected_html + "<b>ID: </b>" + id + "<br/><b>IP: </b>" + ip + "<br/><b>Connection time: </b>" + start + "<br/><br/>";
				}else{
					disconnected_html = disconnected_html  + "<b>ID: </b>" + id + "<br/><b>IP: </b>" + ip + "<br/><b>Connection time: </b>" + start + "<br/><b>Disconnect time: </b>" + end +  "<br/><br/>"; 
				}
			}

			document.getElementById("connected list").innerHTML = connected_html;
			document.getElementById("disconnected list").innerHTML = disconnected_html;
		});

		function downloadUrl(url, callback) {
			var request = window.ActiveXObject ?
				new ActiveXObject('Microsoft.XMLHTTP') :
				new XMLHttpRequest;

			request.onreadystatechange = function() {
				if (request.readyState == 4) {
					request.onreadystatechange = doNothing;
					callback(request, request.status);
				}
			};

			request.open('GET', url, true);
			request.send(null);
		}

		function doNothing() {}
	</script>

</body>
</html>